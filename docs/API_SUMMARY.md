# åŸ¹è®­ç­è¯¾æ—¶ç®¡ç†ç³»ç»Ÿ API æ¥å£æ€»ç»“

## ğŸ¯ æ¥å£æ¦‚è§ˆ

æ‰€æœ‰æ¥å£éƒ½å·²æ›´æ–°ä¸ºæ–°çš„æ ¼å¼å’Œè·¯å¾„ï¼Œç»Ÿä¸€è¿”å›JSONæ ¼å¼ï¼ŒåŒ…å«æˆåŠŸ/å¤±è´¥çŠ¶æ€ã€‚

## ğŸ“‹ æ¥å£åˆ—è¡¨

### 1. **POST /students** - æ·»åŠ å­¦ç”Ÿ
- **åŠŸèƒ½**: æ·»åŠ æ–°å­¦ç”Ÿåˆ°ç³»ç»Ÿ
- **è¯·æ±‚ä½“**: `{ "name": "å¼ ä¸‰", "phone": "13800138000" }`
- **æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "name": "å¼ ä¸‰",
    "phone": "13800138000",
    "remaining_hours": 0
  },
  "message": "å­¦ç”Ÿæ·»åŠ æˆåŠŸ"
}
```

### 2. **GET /students** - è·å–æ‰€æœ‰å­¦ç”Ÿ
- **åŠŸèƒ½**: è·å–ç³»ç»Ÿä¸­æ‰€æœ‰å­¦ç”Ÿçš„åˆ—è¡¨
- **è¯·æ±‚å‚æ•°**: æ— 
- **æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "å¼ ä¸‰",
      "phone": "13800138000",
      "remaining_hours": 18
    }
  ],
  "message": "è·å–å­¦ç”Ÿåˆ—è¡¨æˆåŠŸ"
}
```

### 3. **GET /students/:id** - è·å–å­¦ç”Ÿè¯¦æƒ…
- **åŠŸèƒ½**: è·å–æŒ‡å®šå­¦ç”Ÿçš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å‰©ä½™è¯¾æ—¶ã€å……å€¼è®°å½•å’Œä¸Šè¯¾è®°å½•
- **è·¯å¾„å‚æ•°**: `id` - å­¦ç”ŸID
- **æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "data": {
    "student": {
      "id": 1,
      "name": "å¼ ä¸‰",
      "phone": "13800138000",
      "remaining_hours": 18
    },
    "income_records": [
      {
        "id": 1,
        "student_id": 1,
        "amount": 1000,
        "date": "2024-01-01"
      }
    ],
    "class_records": [
      {
        "id": 1,
        "student_id": 1,
        "hours_used": 2,
        "date": "2024-01-01"
      }
    ]
  },
  "message": "è·å–å­¦ç”Ÿè¯¦æƒ…æˆåŠŸ"
}
```

### 4. **POST /students/:id/recharge** - å­¦ç”Ÿå……å€¼
- **åŠŸèƒ½**: ä¸ºå­¦ç”Ÿå……å€¼è¯¾æ—¶å’Œé‡‘é¢
- **è·¯å¾„å‚æ•°**: `id` - å­¦ç”ŸID
- **è¯·æ±‚ä½“**: `{ "amount": 1000, "hours": 20 }`
- **æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "data": {
    "student_id": 1,
    "amount": 1000,
    "hours": 20,
    "date": "2024-01-01"
  },
  "message": "å……å€¼æˆåŠŸ"
}
```

### 5. **POST /students/:id/consume** - å­¦ç”Ÿä¸Šè¯¾
- **åŠŸèƒ½**: å­¦ç”Ÿä¸Šè¯¾ï¼Œæ‰£é™¤ç›¸åº”è¯¾æ—¶
- **è·¯å¾„å‚æ•°**: `id` - å­¦ç”ŸID
- **è¯·æ±‚ä½“**: `{ "hours_used": 2 }`
- **æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "data": {
    "student_id": 1,
    "hours_used": 2,
    "remaining_hours": 16,
    "date": "2024-01-01"
  },
  "message": "ä¸Šè¯¾è®°å½•æˆåŠŸ"
}
```

### 6. **POST /students/:id/delete** - åˆ é™¤å­¦ç”Ÿ
- **åŠŸèƒ½**: åˆ é™¤æŒ‡å®šå­¦ç”ŸåŠå…¶æ‰€æœ‰ç›¸å…³è®°å½•
- **è·¯å¾„å‚æ•°**: `id` - å­¦ç”ŸID
- **è¯·æ±‚ä½“**: æ— 
- **æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "data": {
    "student_id": 1,
    "deleted_student": {
      "id": 1,
      "name": "å¼ ä¸‰",
      "phone": "13800138000",
      "remaining_hours": 18
    }
  },
  "message": "å­¦ç”Ÿåˆ é™¤æˆåŠŸ"
}
```

### 7. **GET /stats** - è·å–ç»Ÿè®¡æ•°æ®
- **åŠŸèƒ½**: è·å–æŒ‡å®šæ—¶é—´æ®µçš„ç»Ÿè®¡æ•°æ®
- **æŸ¥è¯¢å‚æ•°**: `period` - æ—¶é—´æ®µ (all/month/week/today)
- **æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "data": {
    "total_income": 125000,
    "income_count": 45,
    "total_students": 45,
    "total_hours": 1800,
    "total_classes": 320,
    "total_hours_used": 1560,
    "new_students": 45,
    "recharge_hours": 1800
  },
  "message": "è·å–ç»Ÿè®¡æ•°æ®æˆåŠŸ"
}
```

### 8. **GET /stats/income-trend** - è·å–æ”¶å…¥è¶‹åŠ¿
- **åŠŸèƒ½**: è·å–æ”¶å…¥è¶‹åŠ¿æ•°æ®
- **æŸ¥è¯¢å‚æ•°**: `months` - æŸ¥è¯¢æœˆæ•° (é»˜è®¤12)
- **æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "data": [
    {
      "month": "2024-01",
      "total_amount": 15000,
      "count": 8
    }
  ],
  "message": "è·å–æ”¶å…¥è¶‹åŠ¿æˆåŠŸ"
}
```

### 9. **GET /stats/hours-trend** - è·å–è¯¾æ—¶è¶‹åŠ¿
- **åŠŸèƒ½**: è·å–è¯¾æ—¶æ¶ˆè€—è¶‹åŠ¿æ•°æ®
- **æŸ¥è¯¢å‚æ•°**: `months` - æŸ¥è¯¢æœˆæ•° (é»˜è®¤12)
- **æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "data": [
    {
      "month": "2024-01",
      "total_hours": 120,
      "count": 15
    }
  ],
  "message": "è·å–è¯¾æ—¶è¶‹åŠ¿æˆåŠŸ"
}
```

## ğŸ”„ ç»Ÿä¸€å“åº”æ ¼å¼

### æˆåŠŸå“åº”
```json
{
  "success": true,
  "data": { /* å…·ä½“æ•°æ® */ },
  "message": "æ“ä½œæˆåŠŸæè¿°"
}
```

### é”™è¯¯å“åº”
```json
{
  "success": false,
  "error": "é”™è¯¯ç±»å‹",
  "message": "é”™è¯¯æè¿°"
}
```

## ğŸ“Š é”™è¯¯ç è¯´æ˜

| çŠ¶æ€ç  | é”™è¯¯ç±»å‹ | è¯´æ˜ |
|--------|----------|------|
| 400 | å‚æ•°é”™è¯¯ | è¯·æ±‚å‚æ•°ç¼ºå¤±æˆ–æ ¼å¼é”™è¯¯ |
| 400 | æ•°æ®é‡å¤ | æ‰‹æœºå·å·²å­˜åœ¨ |
| 400 | è¯¾æ—¶ä¸è¶³ | å‰©ä½™è¯¾æ—¶ä¸è¶³ä»¥å®Œæˆæ“ä½œ |
| 404 | å­¦ç”Ÿä¸å­˜åœ¨ | æŒ‡å®šçš„å­¦ç”ŸIDä¸å­˜åœ¨ |
| 500 | æ•°æ®åº“æ“ä½œå¤±è´¥ | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |
| 500 | åˆ é™¤å¤±è´¥ | åˆ é™¤å­¦ç”Ÿæˆ–ç›¸å…³è®°å½•å¤±è´¥ |

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### ä½¿ç”¨æµ‹è¯•è„šæœ¬
```bash
node test_new_api.js
```

### ä½¿ç”¨ curl æµ‹è¯•
```bash
# æ·»åŠ å­¦ç”Ÿ
curl -X POST http://localhost:3000/students \
  -H "Content-Type: application/json" \
  -d '{"name":"å¼ ä¸‰","phone":"13800138000"}'

# è·å–æ‰€æœ‰å­¦ç”Ÿ
curl -X GET http://localhost:3000/students

# è·å–å­¦ç”Ÿè¯¦æƒ…
curl -X GET http://localhost:3000/students/1

# å­¦ç”Ÿå……å€¼
curl -X POST http://localhost:3000/students/1/recharge \
  -H "Content-Type: application/json" \
  -d '{"amount":1000,"hours":20}'

# å­¦ç”Ÿä¸Šè¯¾
curl -X POST http://localhost:3000/students/1/consume \
  -H "Content-Type: application/json" \
  -d '{"hours_used":2}'

# åˆ é™¤å­¦ç”Ÿ
curl -X POST http://localhost:3000/students/1/delete

# è·å–ç»Ÿè®¡æ•°æ®
curl -X GET "http://localhost:3000/stats?period=month"

# è·å–æ”¶å…¥è¶‹åŠ¿
curl -X GET "http://localhost:3000/stats/income-trend?months=12"

# è·å–è¯¾æ—¶è¶‹åŠ¿
curl -X GET "http://localhost:3000/stats/hours-trend?months=12"
```

## âœ¨ ä¸»è¦æ”¹è¿›

1. **ç»Ÿä¸€è·¯å¾„**: æ‰€æœ‰æ¥å£éƒ½ä½¿ç”¨ `/students` ä½œä¸ºåŸºç¡€è·¯å¾„
2. **ç»Ÿä¸€è¿”å›æ ¼å¼**: æ‰€æœ‰æ¥å£éƒ½è¿”å›åŒ…å« `success`ã€`data`ã€`message` çš„JSON
3. **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç 
4. **æ¥å£å‘½å**: æ›´ç›´è§‚çš„æ¥å£å‘½åï¼ˆå¦‚ `consume` æ›¿ä»£ `attend-class`ï¼‰
5. **æ•°æ®å®Œæ•´æ€§**: ä½¿ç”¨äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
6. **çº§è”åˆ é™¤**: åˆ é™¤å­¦ç”Ÿæ—¶è‡ªåŠ¨åˆ é™¤ç›¸å…³çš„å……å€¼è®°å½•å’Œä¸Šè¯¾è®°å½•

## ğŸš€ å¯åŠ¨æœåŠ¡å™¨

```bash
node app.js
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:3000` å¯åŠ¨ï¼Œå¹¶æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„APIç«¯ç‚¹ã€‚
